name: 02_bgp_fix

topology:
  nodes:
    h1:
      kind: linux
      image: alpine
      labels:
        graph-level: 1
        graph-icon: host
      exec:
        - ip addr add 192.168.1.2/26 dev eth1
        - ip route del 0.0.0.0/0
        - ip route add 0.0.0.0/0 via 192.168.1.1
    h2:
      kind: linux
      image: alpine
      labels:
        graph-level: 1 
        graph-icon: host 
      exec:
        - ip addr add 192.168.2.2/26 dev eth1
        - ip route del 0.0.0.0/0
        - ip route add 0.0.0.0/0 via 192.168.2.1
    h3:
      kind: linux
      image: alpine
      labels:
        graph-level: 1 
        graph-icon: host 
      exec:
        - ip addr add 192.168.2.66/26 dev eth1
        - ip route del 0.0.0.0/0
        - ip route add 0.0.0.0/0 via 192.168.2.65
    h4:
      kind: linux
      image: alpine
      labels:
        graph-level: 1
        graph-icon: host
      exec:
        - ip addr add 192.168.3.2/26 dev eth1
        - ip route del 0.0.0.0/0
        - ip route add 0.0.0.0/0 via 192.168.3.1
    r1:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      labels:
        graph-level: 2
        graph-icon: router
      binds:
        - ./config/r1:/etc/frr:rw
      exec:
        - ip route del 0.0.0.0/0
    r2:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      labels:
        graph-level: 2
        graph-icon: router
      binds:
        - ./config/r2:/etc/frr:rw
      exec:
        - ip route del 0.0.0.0/0
    r3:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      labels:
        graph-level: 2
        graph-icon: router
      binds:
        - ./config/r3:/etc/frr:rw
      exec:
       - ip route del 0.0.0.0/0
    r4:
      kind: linux
      image: quay.io/frrouting/frr:10.4.1
      labels:
        graph-level: 2
        graph-icon: router
      binds:
        - ./config/r4:/etc/frr:rw
      exec:
        - ip route del 0.0.0.0/0
  links:
    - endpoints: [ "h1:eth1", "r1:eth1" ]
    - endpoints: [ "h2:eth1", "r2:eth1" ]
    - endpoints: [ "h3:eth1", "r3:eth1" ]
    - endpoints: [ "h4:eth1", "r4:eth1" ]
    - endpoints: [ "r1:eth2", "r2:eth2" ]
    - endpoints: [ "r2:eth3", "r3:eth2" ]
    - endpoints: [ "r3:eth3", "r4:eth2" ]

